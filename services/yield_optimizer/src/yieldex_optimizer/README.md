# Модуль для оптимизации доходности (Yield Optimizer)

## Обзор

Данный модуль реализует автономный сервис для регулярного анализа доходности DeFi протоколов и автоматического перемещения средств между пулами для максимизации прибыли.

## Базовая инфраструктура (Этап 1)

### Файловая структура

```
src/yield_optimizer/
├── __init__.py         # Инициализационный файл пакета
├── config.py           # Модуль управления конфигурацией 
├── logger.py           # Модуль настройки логирования
└── README.md           # Документация модуля
```

### Компоненты

#### ConfigManager

Класс для управления конфигурацией сервиса. Позволяет:
- Загружать настройки из YAML-файлов
- Переопределять настройки через переменные окружения
- Получать и устанавливать значения конфигурации
- Сохранять конфигурацию в файл

Пример использования:

```python
from src.yield_optimizer.config import ConfigManager

# Создаем экземпляр с указанием пути к конфигурационному файлу
config = ConfigManager('config/default.yaml')

# Получаем значение из конфигурации
chain = config.get('chain', 'Arbitrum')  # 'Arbitrum' - значение по умолчанию

# Устанавливаем значение в конфигурации
config.set('check_interval_hours', 12)

# Получаем копию всей конфигурации
all_settings = config.get_all()

# Сохраняем конфигурацию в файл
config.save('config/my_config.yaml')
```

#### Модуль логирования

Функции для настройки логгеров. Позволяют:
- Создавать логгеры с различными параметрами
- Настраивать вывод в файл и/или консоль
- Управлять уровнем логирования
- Форматировать сообщения логов

Пример использования:

```python
from src.yield_optimizer.logger import setup_logger, setup_service_logger

# Создаем обычный логгер
logger = setup_logger(
    logger_name='my_logger',
    log_level='INFO',
    log_file='logs/my_log.log',
    console=True
)
logger.info('This is an info message')

# Создаем логгер сервиса на основе конфигурации
config = {
    'log_level': 'DEBUG',
    'log_dir': 'logs',
    'console_logs': True
}
service_logger = setup_service_logger(config)
service_logger.debug('This is a debug message')
```

### Конфигурация

Стандартный конфигурационный файл расположен в `config/default.yaml` и включает следующие настройки:

- **Основные настройки**: блокчейн, порог прибыльности, интервал проверок
- **Безопасность**: максимальная цена газа, допустимое проскальзывание
- **Функциональность**: предложение новых пулов
- **Логирование**: уровень, формат, ротация файлов
- **Протоколы**: список поддерживаемых протоколов

### Переменные окружения

Настройки можно переопределить через переменные окружения:

- `YIELD_MIN_PROFIT` - Минимальный порог прибыльности (%)
- `YIELD_CHECK_INTERVAL` - Периодичность проверок (часы)
- `YIELD_MAX_GAS` - Максимальная цена газа (Gwei)
- `YIELD_CHAIN` - Используемый блокчейн
- `YIELD_MAX_RECS` - Максимальное количество рекомендаций
- `YIELD_SUGGEST_ENTRY` - Предлагать новые пулы (true/false)
- `YIELD_MAX_SLIPPAGE` - Допустимое проскальзывание (%)
- `YIELD_LOG_LEVEL` - Уровень логирования

### Тесты

Тесты для модуля расположены в `tests/yield_optimizer/`:

- `test_config.py` - Тесты для ConfigManager
- `test_logger.py` - Тесты для функций логирования

Запуск тестов:

```bash
# Запуск всех тестов модуля
./scripts/run_tests.sh

# Запуск конкретного теста
./scripts/run_tests.sh tests/yield_optimizer/test_config.py
```

## Следующие шаги (Этап 2)

- Реализация YieldOptimizerService
- Разработка TransactionTracker
- Создание OptimizationScheduler
- Написание интеграционных тестов 